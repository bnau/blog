---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";

const allVeilles = await getCollection("veille");
const veilles = allVeilles.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="fr">
	<head>
		<BaseHead
			title={`Veille - ${SITE_TITLE}`}
			description="Ma veille technologique : articles, ressources et confÃ©rences"
		/>
		<style>
			main {
				width: 960px;
			}
			h2 {
				margin-bottom: 1em;
			}
			ul {
				display: flex;
				flex-wrap: wrap;
				gap: 2rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			ul li {
				width: calc(50% - 1rem);
			}
			.veille-card {
				display: block;
				padding: 1.5rem;
				border: 1px solid rgb(var(--gray-light));
				border-radius: 8px;
				transition:
					box-shadow 0.2s ease,
					transform 0.2s ease;
				text-decoration: none;
			}
			.veille-card:hover {
				box-shadow: 0 4px 12px rgba(var(--black), 10%);
				transform: translateY(-2px);
			}
			.title {
				margin: 0 0 0.5rem 0;
				color: rgb(var(--black));
				line-height: 1.3;
				font-size: 1.4rem;
			}
			.date {
				margin: 0 0 0.5rem 0;
				color: rgb(var(--gray));
				font-size: 0.9rem;
			}
			.themes {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				margin-top: 0.75rem;
			}
			.theme-tag {
                background: rgba(129,140,248,0.1);
                color: rgb(129,140,248);
                padding: 0.15rem 0.5rem;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase
			}
			@media (max-width: 720px) {
				ul {
					gap: 0.5em;
				}
				ul li {
					width: 100%;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section>
			<h2>Ma veille technologique</h2>
				<ul>
					{
						veilles.map((veille) => (
							<li>
								<a
									href={`/veille/${veille.id}/`}
									class="veille-card"
								>
									<div class="date">
										<FormattedDate date={veille.data.pubDate} />
									</div>
									<h4 class="title">Veille du <FormattedDate date={veille.data.pubDate} long={true}/></h4>
									<div class="themes">
										{veille.data.themes.map((theme) => (
											<span class="theme-tag">{theme.name}</span>
										))}
									</div>
								</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<Footer />
	</body>
</html>
